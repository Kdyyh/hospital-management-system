# åŒ»é™¢ç³»ç»ŸAPIå¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£æä¾›äº†åŒ»é™¢ç³»ç»Ÿæ‰€æœ‰APIçš„è¯¦ç»†è¯´æ˜ï¼Œæ–¹ä¾¿å‰ç«¯å¼€å‘äººå‘˜ä½¿ç”¨ã€‚

## ğŸ¥ ç³»ç»Ÿæ¦‚è¿°

åŒ»é™¢ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„åŒ»ç–—æœåŠ¡å¹³å°ï¼Œæä¾›æ‚£è€…ç®¡ç†ã€ç§‘å®¤ç®¡ç†ã€é˜Ÿåˆ—ç®¡ç†ã€å’¨è¯¢ç³»ç»Ÿç­‰åŠŸèƒ½ã€‚ç³»ç»Ÿé‡‡ç”¨RESTful APIè®¾è®¡ï¼Œä½¿ç”¨Tokenè®¤è¯æ–¹å¼ã€‚

## ğŸ“‹ åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `http://127.0.0.1:8000`
- **è®¤è¯æ–¹å¼**: Tokenè®¤è¯ (åœ¨Headerä¸­æ·»åŠ  `Authorization: Token {token}`)
- **Content-Type**: `application/json`
- **å­—ç¬¦ç¼–ç **: UTF-8
- **APIç‰ˆæœ¬**: v1
- **å“åº”æ ¼å¼**: JSON

## ğŸ” è®¤è¯æœºåˆ¶

### Tokenè·å–æµç¨‹
1. ç”¨æˆ·é€šè¿‡ç™»å½•æ¥å£è·å–token
2. åœ¨åç»­è¯·æ±‚çš„Headerä¸­æºå¸¦token: `Authorization: Token {token}`
3. Tokenæœ‰æ•ˆæœŸä¸º24å°æ—¶
4. Tokenè¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•è·å–

### å®‰å…¨è¦æ±‚
- æ‰€æœ‰æ•æ„Ÿæ“ä½œéƒ½éœ€è¦Tokenè®¤è¯
- å¯†ç ä¼ è¾“å¿…é¡»ä½¿ç”¨HTTPSåŠ å¯†
- Tokenéœ€è¦å®‰å…¨å­˜å‚¨ï¼Œé¿å…æ³„éœ²

## ğŸ” ç”¨æˆ·è®¤è¯API

### ç”¨æˆ·ç™»å½•
- **ç«¯ç‚¹**: `POST /api/auth/login`
- **æƒé™**: æ— éœ€è®¤è¯
- **å‚æ•°**: 
  ```json
  {
    "username": "ç”¨æˆ·å (å­—ç¬¦ä¸²ï¼Œå¿…å¡«)",
    "password": "å¯†ç  (å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œæœ€å°é•¿åº¦6ä½)"
  }
  ```
- **æˆåŠŸå“åº” (200)**: 
  ```json
  {
    "ok": true,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "admin1",
      "email": "admin1@hospital.com",
      "role": "admin",
      "first_name": "Admin1",
      "last_name": "åŒ»ç”Ÿ",
      "group": {
        "id": "g1",
        "name": "å†…ç§‘"
      }
    }
  }
  ```
- **å¤±è´¥å“åº” (400)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "validation_error",
      "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
    }
  }
  ```
- **å¤±è´¥å“åº” (500)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "server_error",
      "message": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"
    }
  }
  ```
- **æ³¨æ„äº‹é¡¹**:
  - å¯†ç é”™è¯¯3æ¬¡åä¼šæš‚æ—¶é”å®šè´¦å·5åˆ†é’Ÿ
  - Tokenæœ‰æ•ˆæœŸä¸º24å°æ—¶
  - å»ºè®®åœ¨å‰ç«¯å®ç°è‡ªåŠ¨é‡è¯•æœºåˆ¶

### ç”¨æˆ·ç™»å‡º
- **ç«¯ç‚¹**: `POST /api/auth/logout`
- **æƒé™**: éœ€è¦è®¤è¯
- **å‚æ•°**: æ— 
- **æˆåŠŸå“åº” (200)**: 
  ```json
  {
    "ok": true,
    "message": "ç™»å‡ºæˆåŠŸ"
  }
  ```
- **å¤±è´¥å“åº” (401)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "authentication_failed",
      "message": "è®¤è¯å¤±è´¥"
    }
  }
  ```
- **åŠŸèƒ½è¯´æ˜**: ä½¿å½“å‰tokenå¤±æ•ˆï¼Œæ— æ³•å†ç”¨äºAPIè°ƒç”¨

### ä¿®æ”¹å¯†ç 
- **ç«¯ç‚¹**: `POST /api/user/change-password`
- **æƒé™**: éœ€è¦è®¤è¯
- **å‚æ•°**:
  ```json
  {
    "oldPassword": "æ—§å¯†ç  (å­—ç¬¦ä¸²ï¼Œå¿…å¡«)",
    "newPassword": "æ–°å¯†ç  (å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œæœ€å°é•¿åº¦8ä½ï¼Œéœ€åŒ…å«å­—æ¯å’Œæ•°å­—)"
  }
  ```
- **æˆåŠŸå“åº” (200)**: 
  ```json
  {
    "ok": true,
    "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"
  }
  ```
- **å¤±è´¥å“åº” (400)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "validation_error",
      "message": "æ–°å¯†ç ä¸ç¬¦åˆå®‰å…¨è¦æ±‚"
    }
  }
  ```
- **å¤±è´¥å“åº” (401)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "authentication_failed", 
      "message": "æ—§å¯†ç ä¸æ­£ç¡®"
    }
  }
  ```
- **å®‰å…¨è¦æ±‚**:
  - æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
  - å¯†ç éœ€è¦åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
  - å»ºè®®å®šæœŸæ›´æ¢å¯†ç 


## ğŸ‘¥ ç”¨æˆ·ç®¡ç†API

### è·å–ç”¨æˆ·èµ„æ–™
- **ç«¯ç‚¹**: `GET /api/user/profile`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·
- **å‚æ•°**: æ— 
- **æˆåŠŸå“åº” (200)**: 
  ```json
  {
    "ok": true,
    "user": {
      "id": 1,
      "username": "admin1",
      "email": "admin1@hospital.com",
      "role": "admin",
      "first_name": "Admin1",
      "last_name": "åŒ»ç”Ÿ",
      "phone": "13800138000",
      "group": {
        "id": "g1",
        "name": "å†…ç§‘"
      },
      "created_at": "2024-01-15T10:30:00Z",
      "last_login": "2024-01-20T14:25:00Z"
    }
  }
  ```
- **å¤±è´¥å“åº” (401)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "authentication_failed",
      "message": "è®¤è¯å¤±è´¥"
    }
  }
  ```

### æ›´æ–°ç”¨æˆ·èµ„æ–™
- **ç«¯ç‚¹**: `POST /api/user/profile/update`
- **æƒé™**: éœ€è¦è®¤è¯
- **å‚æ•°**:
  ```json
  {
    "first_name": "åå­— (å­—ç¬¦ä¸²ï¼Œå¯é€‰)",
    "last_name": "å§“æ° (å­—ç¬¦ä¸²ï¼Œå¯é€‰)", 
    "email": "é‚®ç®± (å­—ç¬¦ä¸²ï¼Œå¯é€‰ï¼Œéœ€ç¬¦åˆé‚®ç®±æ ¼å¼)",
    "phone": "ç”µè¯å·ç  (å­—ç¬¦ä¸²ï¼Œå¯é€‰)"
  }
  ```
- **æˆåŠŸå“åº” (200)**: 
  ```json
  {
    "ok": true,
    "message": "ç”¨æˆ·èµ„æ–™æ›´æ–°æˆåŠŸ",
    "user": {æ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯}
  }
  ```
- **å¤±è´¥å“åº” (400)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "validation_error",
      "message": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
    }
  }
  ```

### ç”¨æˆ·æ³¨å†Œ
- **ç«¯ç‚¹**: `POST /api/user/register`
- **æƒé™**: æ— éœ€è®¤è¯
- **å‚æ•°**:
  ```json
  {
    "username": "ç”¨æˆ·å (å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œ3-20å­—ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯æ•°å­—å’Œä¸‹åˆ’çº¿)",
    "password": "å¯†ç  (å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œæœ€å°8ä½ï¼Œéœ€åŒ…å«å­—æ¯å’Œæ•°å­—)",
    "role": "ç”¨æˆ·è§’è‰² (å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œå¯é€‰å€¼: patient, admin, core, super)",
    "email": "é‚®ç®± (å­—ç¬¦ä¸²ï¼Œå¯é€‰)",
    "first_name": "åå­— (å­—ç¬¦ä¸²ï¼Œå¯é€‰)",
    "last_name": "å§“æ° (å­—ç¬¦ä¸²ï¼Œå¯é€‰)"
  }
  ```
- **æˆåŠŸå“åº” (201)**: 
  ```json
  {
    "ok": true,
    "message": "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ",
    "user": {
      "id": 123,
      "username": "newuser",
      "role": "patient"
    }
  }
  ```
- **å¤±è´¥å“åº” (400)**: 
  ```json
  {
    "ok": false,
    "error": {
      "code": "validation_error",
      "message": "ç”¨æˆ·åå·²å­˜åœ¨"
    }
  }
  ```
- **æ³¨æ„äº‹é¡¹**:
  - ç”¨æˆ·åå¿…é¡»å”¯ä¸€
  - å¯†ç éœ€è¦ç¬¦åˆå®‰å…¨ç­–ç•¥
  - æ³¨å†Œåéœ€è¦ç®¡ç†å‘˜å®¡æ ¸æ‰èƒ½æ¿€æ´»ï¼ˆå¦‚è§’è‰²ä¸ºadmin/coreï¼‰

## ç§‘å®¤/éƒ¨é—¨ç®¡ç†API

### è·å–ç§‘å®¤åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/departments`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### è·å–ç§‘å®¤æˆå‘˜
- **ç«¯ç‚¹**: `GET /api/departments/members`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### è·å–ç§‘å®¤ç®¡ç†å‘˜
- **ç«¯ç‚¹**: `GET /api/departments/admins`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### è·å–ç§‘å®¤é…ç½®
- **ç«¯ç‚¹**: `GET /api/departments/configs`
- **æƒé™**: è¶…çº§ç®¡ç†å‘˜

## æ‚£è€…ç®¡ç†API

### è·å–æ‚£è€…åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/patients`
- **æƒé™**: è¶…çº§ç®¡ç†å‘˜
- **æŸ¥è¯¢å‚æ•°**: 
  - `deptId`: ç§‘å®¤ID (å¯é€‰)
  - `page`: é¡µç 
  - `pageSize`: æ¯é¡µæ•°é‡

### å¯¼å‡ºæ‚£è€…æ•°æ®
- **ç«¯ç‚¹**: `GET /api/patients/export`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### æ‚£è€…æ³¨å†Œ
- **ç«¯ç‚¹**: `POST /api/patient/register`
- **å‚æ•°**:
  ```json
  {
    "name": "æ‚£è€…å§“å",
    "sex": "æ€§åˆ«",
    "age": å¹´é¾„,
    "phone": "ç”µè¯å·ç ",
    "disease": "ç–¾ç—…",
    "groupId": "ç§‘å®¤ID"
  }
  ```

## é˜Ÿåˆ—ç®¡ç†API

### è·å–é˜Ÿåˆ—çŠ¶æ€
- **ç«¯ç‚¹**: `GET /api/queue/status`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### è·å–é˜Ÿåˆ—åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/queue/list`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### ç®¡ç†é˜Ÿåˆ—åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/admin/queue/list`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### é˜Ÿåˆ—ç»Ÿè®¡
- **ç«¯ç‚¹**: `GET /api/admin/queue/stats`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### æ‰€æœ‰ç®¡ç†é˜Ÿåˆ—
- **ç«¯ç‚¹**: `GET /api/admin/queue/list-all`
- **æƒé™**: è¶…çº§ç®¡ç†å‘˜

## å’¨è¯¢ç³»ç»ŸAPI

### è·å–å’¨è¯¢åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/inquiries`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### è·å–æ‚£è€…å’¨è¯¢
- **ç«¯ç‚¹**: `GET /api/patient/inquiries`
- **æƒé™**: æ‚£è€…ç”¨æˆ·

### å›å¤å’¨è¯¢
- **ç«¯ç‚¹**: `POST /api/inquiries/reply`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š
- **å‚æ•°**:
  ```json
  {
    "inquiryId": "å’¨è¯¢ID",
    "text": "å›å¤å†…å®¹"
  }
  ```

## ä»»åŠ¡ç®¡ç†API

### è·å–ä»»åŠ¡åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/tasks`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### è·å–ä»»åŠ¡è¯¦æƒ…
- **ç«¯ç‚¹**: `GET /api/tasks/{id}`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

## æ¶ˆæ¯ç³»ç»ŸAPI

### è·å–æ¶ˆæ¯åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/messages`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### è·å–æ‚£è€…æ¶ˆæ¯
- **ç«¯ç‚¹**: `GET /api/patient/messages`
- **æƒé™**: æ‚£è€…ç”¨æˆ·

## KPIç»Ÿè®¡API

### è·å–æ‰€æœ‰KPI
- **ç«¯ç‚¹**: `GET /api/kpi/all`
- **æƒé™**: è¶…çº§ç®¡ç†å‘˜

### è·å–ä¸ªäººKPI
- **ç«¯ç‚¹**: `GET /api/kpi/my`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### è·å–ç§‘å®¤KPI
- **ç«¯ç‚¹**: `GET /api/kpi/department`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

## ä»ªè¡¨æ¿API

### ç®¡ç†ä»ªè¡¨æ¿
- **ç«¯ç‚¹**: `GET /api/admin/dashboard`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

## å¹¿å‘Šç®¡ç†API

### è·å–å¹¿å‘Šåˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/ads`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

## åˆ†ç»„ç®¡ç†API

### è·å–åˆ†ç»„åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/groups`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### åˆ›å»ºåˆ†ç»„
- **ç«¯ç‚¹**: `POST /api/groups/create`
- **æƒé™**: è¶…çº§ç®¡ç†å‘˜
- **å‚æ•°**:
  ```json
  {
    "name": "åˆ†ç»„åç§°",
    "description": "åˆ†ç»„æè¿°"
  }
  ```

### è·å–é‚€è¯·åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/groups/invites`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### è·å–è½¬ç§»è¯·æ±‚
- **ç«¯ç‚¹**: `GET /api/groups/transfer-requests`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

## ç”¨æˆ·ç»‘å®šAPI

### ç»‘å®šç§‘å®¤
- **ç«¯ç‚¹**: `POST /api/user/bind-department`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·
- **å‚æ•°**:
  ```json
  {
    "departmentId": "ç§‘å®¤ID"
  }
  ```

### æ£€æŸ¥ç§‘å®¤ç»‘å®š
- **ç«¯ç‚¹**: `GET /api/user/check-department-binding`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

### è·å–å¯ç”¨ç§‘å®¤
- **ç«¯ç‚¹**: `GET /api/user/available-departments`
- **æƒé™**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

## ç®¡ç†å‘˜åŠŸèƒ½API

### è·å–ç®¡ç†å‘˜èµ„æ–™
- **ç«¯ç‚¹**: `GET /api/admin/profile`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

### è·å–æ“ä½œæ—¥å¿—
- **ç«¯ç‚¹**: `GET /api/report/log`
- **æƒé™**: ç®¡ç†å‘˜ä»¥ä¸Š

## å¥åº·æ£€æŸ¥

### å¥åº·æ£€æŸ¥
- **ç«¯ç‚¹**: `GET /healthz`
- **æƒé™**: æ— éœ€è®¤è¯

## æµ‹è¯•ç”¨æˆ·è´¦å·

ç³»ç»Ÿæä¾›äº†ä»¥ä¸‹æµ‹è¯•ç”¨æˆ·è´¦å·ï¼š

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | æƒé™ |
|--------|------|------|------|
| admin1 | 123456 | admin | ç®¡ç†å‘˜æƒé™ |
| core1 | 123456 | core | æ ¸å¿ƒç”¨æˆ·æƒé™ |
| super | 123456 | super | è¶…çº§ç®¡ç†å‘˜æƒé™ |
| patient1 | 123456 | patient | æ‚£è€…æƒé™ |

## é”™è¯¯å¤„ç†

æ‰€æœ‰APIè¿”å›ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼ï¼š
```json
{
  "ok": false,
  "error": {
    "code": "é”™è¯¯ä»£ç ",
    "message": "é”™è¯¯ä¿¡æ¯"
  }
}
```

å¸¸è§é”™è¯¯ä»£ç ï¼š
- `api_error`: é€šç”¨APIé”™è¯¯
- `permission_denied`: æƒé™ä¸è¶³
- `not_found`: èµ„æºæœªæ‰¾åˆ°
- `validation_error`: å‚æ•°éªŒè¯é”™è¯¯

## å“åº”æ—¶é—´

APIå¹³å‡å“åº”æ—¶é—´åœ¨0.01-0.21ç§’ä¹‹é—´ï¼Œæ€§èƒ½è‰¯å¥½ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### ç™»å½•ç¤ºä¾‹
```javascript
const login = async () => {
  const response = await fetch('http://127.0.0.1:8000/api/auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      username: 'admin1',
      password: '123456'
    })
  });
  const data = await response.json();
  const token = data.token;
  // ä¿å­˜tokenç”¨äºåç»­è¯·æ±‚
  localStorage.setItem('token', token);
};
```

### å¸¦è®¤è¯çš„è¯·æ±‚ç¤ºä¾‹
```javascript
const getPatients = async () => {
  const token = localStorage.getItem('token');
  const response = await fetch('http://127.0.0.1:8000/api/patients', {
    method: 'GET',
    headers: {
      'Authorization': `Token ${token}`,
      'Content-Type': 'application/json'
    }
  });
  const data = await response.json();
  return data;
};
```

è¿™ä¸ªæ–‡æ¡£æ¶µç›–äº†æ‰€æœ‰å¯ç”¨çš„APIç«¯ç‚¹ï¼ŒåŒ…æ‹¬ç«¯ç‚¹URLã€HTTPæ–¹æ³•ã€æ‰€éœ€å‚æ•°ã€æƒé™è¦æ±‚å’Œå“åº”æ ¼å¼ã€‚å‰ç«¯å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è¿™ä¸ªæ–‡æ¡£è¿›è¡Œå¼€å‘ã€‚
